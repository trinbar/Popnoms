{% extends 'base.html' %}

{% block title %}PopNoms{% endblock %}

{% block content %}

<div class="row">

  <div class="col-xs-12 col-md-6">

    <h3>PopNoms in {{ location }}</h3>
      <ul class="events">
        {% for event in events %}
          <li><a href="{{ event["eb_url"] }}">{{ event["name"] }}
          </a></li>
        {% endfor %}
      </ul>

  </div>

  <div class="col-xs-12 col-md-6">
    <h3>Map will go here</h3>
      <script 
      src="https://code.jquery.com/jquery-3.4.1.js"
      integrity="sha256-WpOohJOqMqqyKL9FccASB9O0KwACQJpFTUBLTYOVvVU="
      crossorigin="anonymous"></script>

  
    <div id='map' style='width: 500px; height: 600px;'></div>
      <script>


      //Mapbox default accessToken
      mapboxgl.accessToken = 'pk.eyJ1IjoidHJpbmJhciIsImEiOiJjanZ3emhpNXoxZW9kNDRwMWtzaWpwNm8xIn0.2201lSCmgIMWpQndN1igLg';

      //Display map using map_center of location query
      const map = new mapboxgl.Map({
        container: 'map',
        style: 'mapbox://styles/mapbox/streets-v11',
        center: {{ map_center }},
        zoom: 10
      });

      const geojson = {
        type: 'FeatureCollection',
        features: [
        {% for coordinates in coordinates_list %} {
          type: 'Feature',
          geometry: {
            type: 'Point',
            coordinates: {{ coordinates }}
          },
        properties: {
          title: 'Mapbox',
          description: ''
        }
      },{% endfor %}
      ]
      };
      console.log(geojson)

      //add markers to map
      geojson.features.forEach(function(marker) {
        //create an HTML element for each feature
        let el = document.createElement('div');
        el.className = 'marker';
        //make a marker for each feature and add to map
        new mapboxgl.Marker(el)
        .setLngLat(marker.geometry.coordinates)
        .addTo(map);
      });
</script>

    </div>
</div>

{% endblock %}